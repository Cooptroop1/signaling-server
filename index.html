<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>Anonomoose Chat</title>
 <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net 'unsafe-inline'; style-src 'self' https://cdn.jsdelivr.net 'unsafe-inline'; img-src 'self' data: blob: https://raw.githubusercontent.com https://cdnjs.cloudflare.com; media-src 'self' blob: data:; connect-src 'self' wss://signaling-server-zc6m.onrender.com https://api.x.ai;">
 <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" integrity="sha512-wnea99uKIC3TJF7v4eKk4Y+lMz2Mklv18+r4na2Gn1abDRPPOeef95xTzdwGD9e6zXJBteMIhZ1+68QC5byJZw==" crossorigin="anonymous">
 <link rel="icon" type="image/png" href="https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/1f60e.png"/>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.1.6/purify.min.js" integrity="sha512-jB0TkTBeQC9ZSkBqDhdmfTv1qdfbWpGE72yJ/01Srq6hEzZIz2xkz1e57p9ai7IeHMwEG7HpzG6NdptChif5Pg==" crossorigin="anonymous"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/lamejs/1.2.1/lame.min.js"></script>
 <style>
 * {
 cursor: default;
 user-select: none;
 }
 input[type="text"],
 input[type="number"],
 input[type="file"],
 textarea {
 cursor: text;
 user-select: text;
 }
 #codeDisplay {
 user-select: text;
 }
 body {
 min-height: 100vh;
 padding-top: 240px;
 padding-bottom: 140px;
 display: flex;
 justify-content: center;
 align-items: center;
 }
 #messages {
 display: flex;
 flex-direction: column-reverse;
 overflow-y: auto;
 overflow-x: hidden;
 scroll-behavior: auto;
 z-index: 0;
 margin-bottom: 0.5rem;
 border-radius: 0.5rem;
 box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
 position: relative;
 height: 296px;
 background-color: #fce7f3;
 background-image: none;
 background-size: 100% 100%;
 background-position: center;
 background-repeat: no-repeat;
 }
 #messages.waiting {
 background-color: transparent;
 background-image: url('https://raw.githubusercontent.com/Cooptroop1/anonmess/main/logo.JPG?sanitize=true');
 }
 .corner-logo {
 position: absolute;
 top: -5px;
 right: 10px;
 width: 256px;
 height: 256px;
 background-image: url('https://raw.githubusercontent.com/Cooptroop1/anonmess/main/corner%20logo.png?sanitize=true');
 background-size: contain;
 background-repeat: no-repeat;
 background-position: center;
 z-index: 100;
 transition: background-image 0.5s ease;
 }
 .corner-logo.wink {
 background-image: url('https://raw.githubusercontent.com/Cooptroop1/anonmess/main/corner%20logoWink.png?sanitize=true');
 }
 .bg-white {
 z-index: 10;
 max-width: 500px;
 width: 100%;
 margin: 0 auto;
 margin-top: 100px;
 }
 @media (min-width: 641px) and (max-width: 1024px) {
 .corner-logo {
 z-index: -1;
 }
 }
 @media (max-width: 640px) {
 body {
 padding-top: 80px;
 padding-bottom: 80px;
 }
 .bg-white {
 padding: 1rem;
 max-width: none;
 width: 100%;
 margin-top: 50px;
 }
 .corner-logo {
 position: absolute;
 top: 0px;
 right: 10px;
 width: 128px;
 height: 128px;
 z-index: 1000;
 }
 #chatContainer:not(.hidden) #messages.waiting ~ .corner-logo {
 position: absolute;
 top: 0px;
 right: 10px;
 width: 128px;
 height: 128px;
 z-index: 1000;
 }
 #maxClientsContainer {
 position: absolute;
 bottom: -335px;
 left: 50%;
 transform: translateX(-50%);
 width: 100%;
 max-width: 360px;
 margin: 0;
 padding: 0.75rem;
 background-color: #000000;
 border-radius: 0.5rem;
 z-index: 1000;
 }
 #maxClientsRadios {
 display: grid;
 grid-template-columns: repeat(5, minmax(0, 1fr));
 gap: 0.3rem;
 justify-items: center;
 }
 #maxClientsRadios button {
 background-color: #3b82f6;
 color: white;
 border-radius: 0.5rem;
 padding: 0.4rem;
 font-size: 0.9rem;
 width: 100%;
 text-align: center;
 box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
 transition: all 0.2s ease;
 }
 #maxClientsRadios button.active {
 background-color: #10b981;
 }
 #maxClientsRadios button:hover:not(:disabled) {
 background-color: #1d4ed8;
 }
 #maxClientsRadios button:disabled {
 opacity: 0.6;
 cursor: not-allowed;
 }
 .button-group {
 margin: 0.5rem 0.3rem;
 width: calc(100% - 0.6rem);
 }
 #messages {
 width: 100%;
 max-width: none;
 }
 h1.text-3xl {
 font-size: 1.5rem;
 margin-bottom: 0.75rem;
 padding: 0.25rem 0;
 }
 #status, #privacyStatus {
 font-size: 0.875rem;
 margin-bottom: 0.5rem;
 padding: 0.25rem 0;
 }
 }
 .message-bubble {
 max-width: 70%;
 margin: 0.1rem 1rem;
 padding: 0.25rem 0.5rem;
 border-radius: 1rem;
 overflow-wrap: break-word;
 word-break: break-word;
 hyphens: auto;
 box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
 display: inline-flex;
 flex-direction: column;
 align-items: flex-start;
 }
 .message-bubble img, .message-bubble audio {
 max-width: 100%;
 border-radius: 0.5rem;
 margin: 0.15rem 0 0.5rem;
 }
 .message-bubble.self {
 background-color: #3b82f6;
 color: white;
 margin-left: auto;
 border-bottom-right-radius: 0.25rem;
 }
 .message-bubble.other {
 background-color: #10b981;
 color: white;
 margin-right: auto;
 border-bottom-left-radius: 0.25rem;
 }
 .timestamp {
 font-size: 0.5rem;
 opacity: 0.8;
 }
 .modal {
 display: none;
 position: fixed;
 top: 0;
 left: 0;
 width: 100%;
 height: 100%;
 background-color: rgba(0, 0, 0, 0.9);
 z-index: 2000;
 align-items: center;
 justify-content: center;
 }
 .modal img, .modal audio {
 max-width: 90%;
 max-height: 90%;
 border-radius: 0.5rem;
 }
 .modal.active {
 display: flex;
 }
 .help-modal {
 display: none;
 position: fixed;
 top: 0;
 left: 0;
 width: 100%;
 height: 100%;
 background-color: rgba(0, 0, 0, 0.7);
 z-index: 2000;
 align-items: center;
 justify-content: center;
 }
 .help-modal-content {
 background-color: white;
 padding: 1.5rem;
 border-radius: 0.5rem;
 max-width: 90%;
 max-height: 90%;
 overflow-y: auto;
 box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
 }
 .help-modal.active {
 display: flex;
 }
 #chatContainer.hidden {
 display: none;
 visibility: hidden;
 }
 #chatContainer {
 display: flex;
 flex-direction: column;
 gap: 0.5rem;
 position: relative;
 }
 .input-container {
 display: flex;
 align-items: flex-start;
 gap: 0.75rem;
 margin: 0.5rem 0.8rem;
 width: calc(100% - 1.6rem);
 box-sizing: border-box;
 z-index: 10;
 }
 .input-container.hidden {
 display: none;
 }
 #messageInput {
 resize: none;
 overflow-y: auto;
 height: 2.5rem;
 max-height: 12.5rem;
 line-height: 1.5rem;
 flex: 1;
 min-width: 0;
 background-color: #3b82f6;
 color: white;
 border-radius: 1rem;
 padding: 0.5rem 1rem;
 border: none;
 box-sizing: border-box;
 box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
 transition: all 0.2s ease;
 }
 #imageButton, #voiceButton, #voiceCallButton, #sendButton, #grokButton {
 width: 2.5rem;
 height: 2.5rem;
 border-radius: 50%;
 display: flex;
 align-items: center;
 justify-content: center;
 font-size: 1.2rem;
 box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
 transition: all 0.2s ease;
 flex-shrink: 0;
 }
 #imageButton, #voiceButton, #voiceCallButton, #grokButton {
 background-color: #10b981;
 color: white;
 }
 #imageButton:hover, #voiceButton:hover, #voiceCallButton:hover, #grokButton:hover {
 background-color: #059669;
 }
 #voiceButton.recording, #voiceCallButton.active, #grokButton.active {
 background-color: #ef4444;
 }
 #voiceTimer {
 font-size: 0.8rem;
 color: white;
 background-color: #6b7280;
 padding: 0.3rem 0.6rem;
 border-radius: 0.5rem;
 display: none;
 align-items: center;
 justify-content: center;
 }
 @media (max-width: 640px) {
 .input-container {
 margin: 0.5rem 0.3rem;
 width: calc(100% - 0.6rem);
 }
 #messageInput {
 padding: 0.5rem 0.75rem;
 }
 }
 #messageInput::-webkit-scrollbar {
 display: none;
 }
 #messageInput {
 -ms-overflow-style: none;
 scrollbar-width: none;
 }
 #sendButton {
 background-color: #2563eb;
 color: white;
 }
 #sendButton:hover {
 background-color: #1d4ed8;
 }
 .button-group {
 display: flex;
 justify-content: space-between;
 margin: 0.5rem 0.8rem;
 width: calc(100% - 1.6rem);
 box-sizing: border-box;
 }
 .button-group button {
 padding: 0.35rem 0.9rem;
 border-radius: 0.375rem;
 cursor: pointer;
 box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
 transition: all 0.2s ease;
 flex: 1;
 margin: 0 0.25rem;
 }
 #button1 {
 background-color: #9b59b6;
 color: white;
 margin-left: -3.25mm;
 }
 #button1:hover {
 background-color: #8e44ad;
 }
 #button2 {
 background-color: #f1c40f;
 color: white;
 }
 #button2:hover {
 background-color: #d4a017;
 }
 #button2:disabled {
 background-color: #d4a017;
 opacity: 0.6;
 cursor: not-allowed;
 }
 #copyCodeButton {
 background-color: #10b981;
 color: white;
 margin-right: -3.25mm;
 }
 #copyCodeButton:hover {
 background-color: #059669;
 }
 #helpText {
 color: #3b82f6;
 cursor: pointer;
 transition: color 0.2s ease;
 }
 #helpText:hover {
 color: #1d4ed8;
 }
 @media (min-width: 1025px) {
 .bg-white {
 margin-top: -165px;
 }
 #maxClientsContainer {
 min-height: calc(100% + 37.8px);
 margin-top: -50px;
 }
 }
 @media (min-width: 641px) and (max-width: 1024px) {
 .bg-white {
 margin-top: -165px;
 }
 #maxClientsContainer {
 margin-top: -50px;
 }
 }
 #maxClientsContainer {
 margin-top: 145px;
 }
 @media (min-width: 641px) {
 #maxClientsRadios {
 display: flex;
 flex-direction: column;
 gap: 0.5rem;
 align-items: center;
 }
 #maxClientsRadios button {
 background-color: #3b82f6;
 color: white;
 border-radius: 0.5rem;
 padding: 0.5rem;
 font-size: 1rem;
 width: 60px;
 text-align: center;
 box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
 transition: all 0.2s ease;
 }
 #maxClientsRadios button.active {
 background-color: #10b981;
 }
 #maxClientsRadios button:hover:not(:disabled) {
 background-color: #1d4ed8;
 }
 #maxClientsRadios button:disabled {
 opacity: 0.6;
 cursor: not-allowed;
 }
 }
 #remoteAudioContainer {
 display: none;
 flex-wrap: wrap;
 justify-content: center;
 margin-top: 0.5rem;
 }
 #remoteAudioContainer audio {
 width: 100%;
 max-width: 300px;
 margin: 0.5rem;
 }
 .hidden {
 display: none !important;
 }
 #grokKeyContainer {
 display: none;
 margin-top: 0.5rem;
 }
 #grokKeyContainer.active {
 display: block;
 }
 #grokApiKey {
 width: 100%;
 padding: 0.5rem;
 border-radius: 0.5rem;
 border: 1px solid #ccc;
 }
 </style>
</head>
<body class="bg-black min-h-screen flex items-center justify-center">
 <div class="corner-logo" id="cornerLogo" role="img" aria-label="Anonomoose Chat logo"></div>
 <div class="flex w-full max-w-xl mx-auto">
 <div class="bg-white p-8 rounded-lg shadow-lg flex-grow">
 <h1 class="text-3xl font-bold mb-8 text-center text-gray-800">Anonomoose Chat</h1>
 <div id="status" class="text-center mb-4 text-gray-600" role="status" aria-live="polite">Start a new chat or connect to an existing one</div>
 <div id="privacyStatus" class="text-center mb-4 text-green-500 text-sm hidden" role="status" aria-live="polite">E2E Encrypted (P2P)</div>
 <div id="initialContainer">
 <button id="startChatToggleButton" class="bg-blue-500 text-white px-4 py-2 rounded w-full mb-2 hover:bg-blue-600 transition-colors" aria-label="Start a new chat">Start Chat</button>
 <button id="connectToggleButton" class="bg-green-500 text-white px-4 py-2 rounded w-full hover:bg-green-600 transition-colors" aria-label="Connect to an existing chat">Connect to Chat</button>
 </div>
 <div id="usernameContainer" class="hidden">
 <label for="usernameInput" class="sr-only">Enter your username</label>
 <input id="usernameInput" type="text" class="border border-gray-300 p-2 w-full mb-2 rounded" placeholder="Enter your username (1-16 chars)" aria-describedby="usernameHelp" maxlength="16">
 <div id="usernameHelp" class="text-sm text-gray-600 mb-2">Username must be 1-16 alphanumeric characters</div>
 <button id="joinWithUsernameButton" class="bg-blue-500 text-white px-4 py-2 rounded w-full hover:bg-blue-600 transition-colors" aria-label="Join chat with username">Join Chat</button>
 <button id="backButton" class="bg-gray-500 text-white px-4 py-2 rounded w-full mt-2 hover:bg-gray-600 transition-colors" aria-label="Back to main menu">Back</button>
 </div>
 <div id="codeDisplay" class="text-center mb-4 font-mono text-lg text-gray-800 hidden" role="region" aria-live="polite"></div>
 <div id="chatContainer" class="hidden">
 <button id="newSessionButton" class="bg-red-500 text-white px-2 py-1 rounded w-full mb-1 hover:bg-red-600 transition-colors hidden" aria-label="Start a new session">New Session</button>
 <div class="button-group">
 <button id="button1" aria-label="Send code to random chat board">Send Code</button>
 <button id="button2" aria-label="Join a random chat">Random Chat</button>
 <button id="copyCodeButton" aria-label="Copy chat code">Copy Code</button>
 </div>
 <div id="messages" class="border border-gray-300 p-4 h-64 overflow-y-auto mb-4 rounded" role="log" aria-live="polite"></div>
 <div class="input-container hidden">
 <label for="messageInput" class="sr-only">Type a message</label>
 <textarea id="messageInput" placeholder="Type a message..." cols="30" maxlength="1000" aria-describedby="messageHelp"></textarea>
 <input type="file" id="imageInput" accept="image/jpeg,image/png" style="display: none;" aria-label="Upload image" />
 <button id="imageButton" title="Send Image" aria-label="Send image">ðŸ“·</button>
 <button id="voiceButton" title="Record Voice" aria-label="Record voice message">ðŸŽ¤</button>
 <button id="voiceCallButton" title="Start Voice Call" aria-label="Start voice call">ðŸ“ž</button>
 <button id="grokButton" title="Toggle Grok Bot" aria-label="Toggle Grok bot">ðŸ¤–</button>
 <span id="voiceTimer" aria-live="assertive"></span>
 <button id="sendButton" aria-label="Send message">ðŸ“¤</button>
 </div>
 <div id="remoteAudioContainer" class="hidden"></div>
 <div id="grokKeyContainer" class="hidden">
 <label for="grokApiKey" class="text-sm text-gray-600">Enter your xAI API Key (private, stored locally):</label>
 <input id="grokApiKey" type="password" class="border border-gray-300 p-2 w-full mb-2 rounded" placeholder="xai_xxxxxxxxxxxx">
 <button id="saveGrokKey" class="bg-green-500 text-white px-4 py-2 rounded w-full hover:bg-green-600">Save Key</button>
 </div>
 </div>
 <div id="connectContainer" class="hidden">
 <label for="usernameConnectInput" class="sr-only">Enter your username</label>
 <input id="usernameConnectInput" type="text" class="border border-gray-300 p-2 w-full mb-2 rounded" placeholder="Enter your username (1-16 chars)" aria-describedby="usernameConnectHelp" maxlength="16">
 <div id="usernameConnectHelp" class="text-sm text-gray-600 mb-2">Username must be 1-16 alphanumeric characters</div>
 <label for="codeInput" class="sr-only">Enter chat code</label>
 <input id="codeInput" type="text" class="border border-gray-300 p-2 w-full mb-2 rounded" placeholder="Enter code (xxxx-xxxx-xxxx-xxxx)" aria-describedby="codeHelp" maxlength="19">
 <div id="codeHelp" class="text-sm text-gray-600 mb-2">Code format: xxxx-xxxx-xxxx-xxxx</div>
 <button id="connectButton" class="bg-green-500 text-white px-4 py-2 rounded w-full hover:bg-green-600 transition-colors" aria-label="Connect to chat">Connect</button>
 <button id="backButtonConnect" class="bg-gray-500 text-white px-4 py-2 rounded w-full mt-2 hover:bg-gray-600 transition-colors" aria-label="Back to main menu">Back</button>
 </div>
 <div class="text-center mt-4">
 <button id="helpText" class="text-blue-500 hover:underline" aria-label="View help information">Help</button>
 </div>
 </div>
 <div id="maxClientsContainer" class="hidden flex flex-col justify-center bg-black p-4 rounded-lg shadow-lg">
 <span class="text-white mb-2 font-bold">Max Users</span>
 <div id="maxClientsRadios" class="grid grid-cols-5 gap-2" role="radiogroup" aria-label="Select maximum number of users"></div>
 </div>
 </div>
 <div id="helpModal" class="help-modal" role="dialog" aria-label="Help information" tabindex="-1">
 <div class="help-modal-content">
 <h2 class="text-xl font-bold mb-4">Button Help</h2>
 <p><strong>Start Chat:</strong> Starts New Chat</p>
 <p><strong>Connect to Chat:</strong> This connects you to a chat that you have code for</p>
 <p><strong>Send Code:</strong> This sends your code to Random chat board</p>
 <p><strong>Random Chat:</strong> This takes you to random chat board for a random chat</p>
 <p><strong>Copy Code:</strong> Copies the code so you can send to people in text or social chats</p>
 <p><strong>Record Voice:</strong> Press to start/stop recording a voice message (max 30 seconds)</p>
 <p><strong>Start Voice Call:</strong> Press to start/stop a voice call</p>
 <p><strong>Toggle Grok Bot:</strong> Enable/disable Grok bot mode. Requires xAI API key. For details, visit https://x.ai/api.</p>
 </div>
 </div>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.1.6/purify.min.js" integrity="sha512-jB0TkTBeQC9ZSkBqDhdmfTv1qdfbWpGE72yJ/01Srq6hEzZIz2xkz1e57p9ai7IeHMwEG7HpzG6NdptChif5Pg==" crossorigin="anonymous"></script>
 <script src="utils.js"></script>
 <script src="init.js"></script>
 <script src="main.js"></script>
 <script src="events.js"></script>
</body>
</html>
